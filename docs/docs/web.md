# Запуск и веб-интерфейс

## Запуск B4

### Первый запуск после установки

После установки B4 не запускается автоматически. Запустите вручную:

```bash
# Linux с systemd
sudo systemctl start b4

# OpenWRT
/etc/init.d/b4 start

# Entware
/opt/etc/init.d/S99b4 start
```

````

### Проверка запуска

```bash
# Проверить процесс
ps | grep b4

# Проверить очереди netfilter
cat /proc/net/netfilter/nfnetlink_queue
```

:::tip Автозапуск при загрузке

```bash
# Linux
sudo systemctl enable b4

# OpenWRT
/etc/init.d/b4 enable
```

:::

## Веб-интерфейс

### Доступ к панели управления

После запуска B4 откройте в браузере:

```
http://IP-роутера:7000
```

Примеры:

- `http://192.168.1.1:7000`
- `http://192.168.0.1:7000`
- `http://10.0.0.1:7000`

:::info Как узнать IP роутера

```bash
# На роутере
ip addr show br0 | grep inet

# С компьютера в сети
ip route | grep default
```

:::

### Главная страница

На главной странице вы увидите:

- **Статус** - работает ли B4
- **Статистика** - обработанные пакеты и соединения
- **Метрики** - TCP/UDP трафик в реальном времени
- **Активные соединения** - текущие подключения

### Раздел "Домены"

Здесь управляют списком обрабатываемых доменов:

1. **Добавить домен** - кнопка "+" или "Add Domain"
2. Введите домен без https:// (например: `youtube.com`)
3. Нажмите "Save"

:::warning Формат доменов
Правильно: `youtube.com`, `netflix.com`

Неправильно: `https://youtube.com`, `www.youtube.com`
:::

### Раздел "Конфигурация"

Основные настройки:

#### TCP настройки

- **Conn Bytes Limit** - после скольких пакетов перестать обрабатывать (обычно 19-25)
- **SYN Fake** - отправлять ли фейковые SYN пакеты

#### UDP настройки

- **Mode** - `fake` (отправлять фейки) или `drop` (блокировать)
- **Fake Seq Length** - количество фейковых пакетов (обычно 6)

#### Фрагментация

- **Strategy** - `tcp` (рекомендуется), `ip` или `none`
- **SNI Position** - где фрагментировать SNI (обычно 1)

#### Фейковые пакеты

- **TTL** - время жизни фейковых пакетов (обычно 8)
- **Strategy** - метод обхода (`pastseq` обычно работает)

:::tip Рекомендуемые настройки
Для большинства случаев подходят настройки по умолчанию. Меняйте только если знаете что делаете.
:::

### Раздел "Логи"

Потоковый вывод логов в реальном времени:

- **Уровни**: Error, Warning, Info, Debug, Trace
- **Фильтр** - поиск по тексту
- **Автопрокрутка** - следить за новыми записями

### Раздел "GeoSite"

Управление категориями сайтов:

1. Загрузите geosite.dat (если не сделали при установке)
2. Выберите категории: `youtube`, `netflix`, `twitter` и т.д.
3. Примените настройки

:::info Источники GeoSite

- **Loyalsoldier** - универсальный, обновляется часто
- **RUNET** - для российских пользователей
- **Nidelon** - альтернативный для РФ
  :::

## Первоначальная настройка

### Быстрый старт

1. **Откройте веб-интерфейс**

   ```
   http://192.168.1.1:7000
   ```

2. **Перейдите в "Домены"**

   - Добавьте проблемные сайты
   - Или используйте GeoSite категории

3. **Проверьте работу**
   - Откройте добавленный сайт
   - Посмотрите статистику на главной

### Настройка для YouTube

:::tip YouTube и другие видео

```bash
# Через командную строку
b4 --sni-domains youtube.com,googlevideo.com,ytimg.com

# Или через GeoSite категорию
b4 --geosite /etc/b4/geosite.dat --geosite-categories youtube
```

:::

### Настройка для соцсетей

В веб-интерфейсе добавьте домены:

- `facebook.com`
- `instagram.com`
- `twitter.com`
- `tiktok.com`

Или используйте соответствующие GeoSite категории.

## Управление сервисом

### Остановка

```bash
# Systemd
sudo systemctl stop b4

# OpenWRT
/etc/init.d/b4 stop
```

### Перезапуск

```bash
# Systemd
sudo systemctl restart b4

# OpenWRT
/etc/init.d/b4 restart
```

:::warning После изменения настроек
Некоторые настройки требуют перезапуска сервиса для применения.
:::

### Просмотр логов

```bash
# Systemd
journalctl -u b4 -f

# OpenWRT
logread -f | grep b4

# Файл лога (если есть)
tail -f /var/log/b4.log
```

## Проверка работы

### Метод 1: Веб-интерфейс

На главной странице смотрите:

- **Processed Packets** - должно расти при открытии сайтов
- **Active Connections** - текущие подключения к заблокированным сайтам

### Метод 2: Командная строка

```bash
# Статистика очередей
cat /proc/net/netfilter/nfnetlink_queue

# Правила iptables
iptables -t mangle -L B4 -n -v

# Правила nftables (если используется)
nft list table inet b4_mangle
```

### Метод 3: Тестовый сайт

Откройте проблемный сайт и проверьте:

1. Загружается ли он теперь
2. Растет ли счетчик пакетов в веб-интерфейсе

:::danger Не работает?
Если сайты не открываются:

1. Проверьте, запущен ли B4
2. Убедитесь, что домен добавлен в список
3. Посмотрите логи на наличие ошибок
4. Попробуйте другие настройки фрагментации
   :::

## Сброс настроек

Если что-то пошло не так:

```bash
# Остановить сервис
sudo systemctl stop b4

# Удалить конфигурацию
rm /etc/b4/b4.json

# Запустить заново (создастся дефолтный конфиг)
sudo systemctl start b4
```

---

**Совет**: Начните с добавления одного проблемного домена и проверьте работу, прежде чем добавлять остальные.
````
